<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'/>
    <title>Cloud Code Demo - 3 - Parse.Cloud.httpRequest</title>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->
    <!--<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />-->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>-->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>-->
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.min.js"></script>
    <script>

    </script>
</head>
<body onload="jsfunction(1)">
<div class="container">
    <span>
        <h2>Bordered Table</h2>
        Sort
        <select id="sorted" onchange="sortByCompleteProfile()">
            <option value="0">All</option>
            <option value="1">True</option>
            <option value="2">False</option>
        </select>
    </span>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Mobile number</th>
            <th>Name</th>
            <th>isComplete</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="profileTable">

        </tbody>
    </table>
    <ul class="pager">
        <li><a onclick="jsfunction(0)" href="#">Previous</a></li>
        <li><input type="text" disabled id="pageno" value="1"></li>
        <li><a onclick="jsfunction(1)" href="#">Next</a></li>
    </ul>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="Login" aria-hidden="true">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Profile</h4>
            </div>
            <div class="modal-body" style="float:none">
                <form id="profileForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Name:</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter name">
                            </div>
                            <div class="form-group">
                                <label>Gender:</label>
                                <select id="genderSelect" class="selectpicker" class="form-control">
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date Of Birth:</label>
                                <input type="date" class="form-control" id="dob" placeholder="Enter Date of Birth">
                            </div>
                            <div class="form-group">
                                <label>Time Of Birth:</label>
                                <input type="time" class="form-control" id="tob" placeholder="Enter Time of Birth">
                            </div>
                            <div class="form-group ui-widget">
                                <label>Birth Place:</label>
                                <input type="text" class="form-control" id="bp" placeholder="Enter Birth Place">
                            </div>
                            <div class="form-group ui-widget">
                                <label>Current Location:</label>
                                <input type="text" class="form-control" id="cl" placeholder="Enter Current Location">
                            </div>

                            <div class="form-group">
                                <label>Weight:</label>
                                <input type="number" class="form-control" id="weight" placeholder="Enter Weight">
                            </div>
                            <div class="form-group">
                                <label>Height:</label>
                                <input type="number" class="form-control" id="height" placeholder="Enter Height">
                            </div>
                            <div class="form-group">
                                <label>Want To Work After Marriage:</label>
                                <select id="workSelect" class="selectpicker" class="form-control">
                                    <option value="0">May be</option>
                                    <option value="1">Yes</option>
                                    <option value="2">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group ui-widget">
                                <label>Religion:</label>
                                <input type="text" class="form-control" id="rel" placeholder="Enter Religion">
                            </div>
                            <div class="form-group">
                                <label>Caste:</label>
                                <input type="text" class="form-control" id="caste" placeholder="Enter Caste">
                            </div>

                            <div class="form-group">
                                <label>Manglik Status:</label>
                                <select id="manglikSelect" class="selectpicker" class="form-control">
                                    <option value="0">Don't Know</option>
                                    <option value="1">Yes</option>
                                    <option value="2">No</option>
                                </select>
                            </div>
                            <div class="form-group ui-widget">
                                <label>Industry:</label>
                                <input type="text" class="form-control" id="work" placeholder="Enter Work">
                            </div>
                            <div class="form-group">
                                <label>Designation:</label>
                                <input type="text" class="form-control" id="desig" placeholder="Enter Designation">
                            </div>
                            <div class="form-group">
                                <label>Company:</label>
                                <input type="text" class="form-control" id="comp" placeholder="Enter Company">
                            </div>
                            <div class="form-group">
                                <label>Current Income(per annum):</label>
                                <input type="number" class="form-control" id="income"
                                       placeholder="Enter Current Income">
                            </div>
                            <div class="form-group ui-widget">
                                <label>Education:</label>
                                <input type="text" class="form-control" id="edu" placeholder="Enter Education">
                                <input type="text" class="form-control" id="spe" placeholder="Enter Specialization">
                            </div>
                            <div class="form-group ui-widget">
                                <label>User Name:</label>
                                <input type="text" class="form-control" id="username" placeholder="Enter User name">
                            </div>
                        </div>
                    </div>
                    <!--
                     Hidden fields
                    -->
                    <div class="form-group">
                        <label></label>
                        <input type="hidden" class="form-control" id="bpobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="clobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="relobj">
                    </div>

                    <div class="form-group">
                        <input type="hidden" class="form-control" id="casteobj">
                    </div>

                    <div class="form-group">
                        <input type="hidden" class="form-control" id="eduobj">
                        <input type="hidden" class="form-control" id="speobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="indusobj">
                    </div>
                    <!-- Hidden Fields-->


                    <div class="form-group hidden">
                        <!--<label>Browse Image:</label>-->
                        <!--<input type='file' onchange="readURL(this);"/>-->
                        <img id="blah" src="user.png" alt="your image" class="images"/>
                    </div>

                    <!--<input class="btn btn-primary" type="button" value="SaveProfile" onclick="saveProfile()"/>-->
                    <button type="button" class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

</div>
</div>

<!--<button type="button" class="btn btn-primary btn-lg" data-target="#myModal"-->
<!--onclick="getAllProfiles(1)">-->
<!--Launch demo modal-->
<!--</button>-->
<!--
Progress Bar
-->
<div id="pleaseWaitDialog" class="modal" data-backdrop="static" data-keyboard="false" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 id="textToShow">Saving...</h1>
            </div>
            <div class="modal-body">
                <div class="progress progress-striped active">
                    <div class="progress-bar" style="width: 100%;"></div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


</body>
<script src='https://www.parsecdn.com/js/parse-1.2.18.min.js'></script>
<script src="js/non-empty.js"></script>
<script>

    var selectedProfile,count= 0,order=0;
    var picFile;
    var currentPageNo;
    Parse.initialize("Uj7WryNjRHDQ0O3j8HiyoFfriHV8blt2iUrJkCN0", "owBEWHkWBEEmmaukvUiKSOJhuSaQcOrKqhzqGNyi");
    function jsfunction(operation) {
        profileCount();
        var val = document.getElementById("pageno").value;
        if (operation == 1 && val<Math.ceil(count/10)) {
            document.getElementById("pageno").value = ++val;

        }
        else if (operation == 0 && val != 1) {
            document.getElementById("pageno").value = --val;
        }
        getAllProfiles(val,order);
    }

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#blah')
                        .attr('src', e.target.result)
                        .width(150)
                        .height(200);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }
    function sortByCompleteProfile() {
        order = parseInt(document.getElementById("sorted").value);
        
        getAllProfiles(currentPageNo,order);
    }
    function login() {
        Parse.Cloud.run('authenticate', {username: '0000000007', password: '12345678'}, {
            success: function (result) {
                window.alert(result.get("username"));
                document.getElementById("result").innerHTML = result.get("username");
            },
            error: function (error) {

            }
        });
    }

    function profileCount(){
        Parse.Cloud.run('getProfileCount', {}, {
            success: function (result) {
                count=result;
            },
            error: function (error) {

            }
        });
    }

    function getAllProfiles(pageNo,order) {
        show("Loading...");
        currentPageNo = pageNo;
        Parse.Cloud.run('getAllProfiles', {pageno: pageNo,order:order}, {
            success: function (result) {
                var html = "";
                for (var i = 0; i < result.length; i++) {
                    html += "<tr><td>" + result[i].get("userId").get("username") + "</td><td>" + result[i].get("name") +
                            "</td><td>" + result[i].get("isComplete") + "</td><td><button class='btn btn-primary' data-toggle='modal' data-target='#myModal' onclick='editProfile(" + JSON.stringify(result[i]) + ")'>EDIT</button></td></tr>";
                }
                close();
                document.getElementById("profileTable").innerHTML = html;
            },
            error: function (error) {

            }
        });
    }
    function addZero(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }
    function editProfile(profile) {
        var dateSet;
        console.log(profile.objectId);
        var objectId = profile.objectId;


        Parse.Cloud.run("getProfile", {profileId: objectId}, {
                    success: function (result) {
                        console.log(result.get("userId").get("username"));
                        selectedProfile = result;
                        document.getElementById("name").value = selectedProfile.get("name");
                        document.getElementById("weight").value = selectedProfile.get("weight");
                        document.getElementById("height").value = selectedProfile.get("height");
                        dateSet = selectedProfile.get("dob");
                        document.getElementById("dob").value = dateSet.getFullYear() + "-" + addZero((dateSet.getMonth() + 1)) + "-" + addZero(dateSet.getDate());//Date(selectedProfile.get("dob"));
                        var timeSet = selectedProfile.get("tob");
                        timeSet.setMinutes(timeSet.getMinutes() - 330);
                        var hrs = timeSet.getHours();
                        var mins = timeSet.getMinutes();
//                        if (mins<0)
//                        {
//                            hrs-=1;
//                            mins=60+mins;
//                        }
//                        alert(timeSet+hrs+":"+mins);

                        document.getElementById("tob").value = addZero(hrs) + ":" + addZero(mins) + ":" + addZero(timeSet.getSeconds());
                        if (selectedProfile.get("religionId") != null)
                            document.getElementById("rel").value = selectedProfile.get("religionId").get("name");
                        if (selectedProfile.get("casteId") != null)
                            document.getElementById("caste").value = selectedProfile.get("casteId").get("name");
                        if (selectedProfile.get("industryId") != null)
                            document.getElementById("work").value = selectedProfile.get("industryId").get("name");
                        if (selectedProfile.get("placeOfBirth") != null)
                            document.getElementById("bp").value = selectedProfile.get("placeOfBirth").get("name") + "," + selectedProfile.get("placeOfBirth").get("Parent").get("name") + "," + selectedProfile.get("placeOfBirth").get("Parent").get("Parent").get("name");
                        if (selectedProfile.get("currentLocation") != null)
                            document.getElementById("cl").value = selectedProfile.get("currentLocation").get("name") + "," + selectedProfile.get("currentLocation").get("Parent").get("name") + "," + selectedProfile.get("currentLocation").get("Parent").get("Parent").get("name");
                        if (selectedProfile.get("education1") != null) {
                            document.getElementById("spe").value = selectedProfile.get("education1").get("name");
                            document.getElementById("edu").value = selectedProfile.get("education1").get("degreeId").get("name");
                        }
                        document.getElementById("desig").value = selectedProfile.get("designation");
                        document.getElementById("income").value = selectedProfile.get("package");
                        document.getElementById("comp").value = selectedProfile.get("placeOfWork");
                        document.getElementById("comp").value = selectedProfile.get("placeOfWork");

                    }
                }
        );
//    function myFun(dateSet){
//        (function () {
//            var date = Date.parse(dateSet);
//           //alert(date);
//            var d=new Date(date);
//            var day= d.getDate();
//            var month= d.getMonth();
//            var year= d.getFullYear();
//            var str=year+"-"+month+"-"+
//            field = document.querySelector('#dob');
//            field.value =
//            console.log(field.value);
//
//        })()

    }

    var doweUpdateAnything = false;
    function saveProfile() {
        doweUpdateAnything = true;
        //to validate if user has filled complete form
        var ifFilled = required();
        // var parseFile = new Parse.File(picFile.name, picFile);
        if (ifFilled) {
            show("Saving...");
            var profileObj = {};
            profileObj.id = selectedProfile.id;
            profileObj.name = document.getElementById("name").value;
            profileObj.gender = document.getElementById("genderSelect").value;
            profileObj.dob = document.getElementById("dob").value;
            profileObj.tob = document.getElementById("tob").value;
            profileObj.birthPlace = document.getElementById("bpobj").value;
            profileObj.currentLocation = document.getElementById("clobj").value;
            profileObj.weight = document.getElementById("weight").value;
            profileObj.height = document.getElementById("height").value;
            profileObj.religion = document.getElementById("relobj").value;
            profileObj.caste = document.getElementById("casteobj").value;
            profileObj.manglik = document.getElementById("manglikSelect").value;
            profileObj.industry = document.getElementById("indusobj").value;
            //alert(typeof profileObj.industry);
            profileObj.designation = document.getElementById("desig").value;
            profileObj.company = document.getElementById("comp").value;
            profileObj.package = document.getElementById("income").value;
            profileObj.education = document.getElementById("speobj").value;
            profileObj.wantToWork = document.getElementById("workSelect").value;
            var profileSaved = new Parse.Object.extend("Profile");
            Parse.Cloud.run("saveProfile", {profiletosave: profileObj}, {
                        success: function (result) {
                            console.log(result);
                            profileSaved = result;
                        },
                        error: function (error) {
                            console.log("inside cloud function error");
                            console.log(error);
                        }
                    }
            ).then(function () {

                        var promises = $('.images').map(function (index, element) {
                            var deferred = $.Deferred();
                            var src = $(element).attr('src');
                            var canvas = document.createElement('CANVAS');
                            var ctx = canvas.getContext('2d');
                            var img = new Image;
                            img.crossOrigin = 'Anonymous';
                            img.onload = function () {
                                canvas.height = img.height;
                                canvas.width = img.width;
                                ctx.drawImage(img, 0, 0);
                                var base64Img = canvas.toDataURL('image/png');
                                // Clean up
                                canvas = null;
                                deferred.resolve(base64Img);
                            };
                            img.src = element.src;
                            return deferred;
                        });

                        $.when.apply($, promises).then(function () {
                            var file;
                            for (var i = 0; i < 1; i++) {
                                file = new Parse.File("profile.jpg", {base64: arguments[i]}); // this part actually saves the image file to parse
                                profileSaved.set("profilePic", file); // set this image to the corosponding column on our object
                            }

                            profileSaved.set("isComplete", true);

                            // save the user object
                            profileSaved.save(null, {
                                success: function (user) {
                                    selectedProfile = user;
                                    close();

                                    $('#myModal').modal('hide');
                                    //alert("Profile Saved");
                                },
                                error: function (user, error) {
                                    console.log('Failed to create new object, with error code: ' + error.message);
                                }
                            }).then(function () {
                                getAllProfiles(document.getElementById("pageno").value);
                            });
                        });
//                    try {
//                        var fileUploadControl = $("#profilePhotoFileUpload")[0];
//                        if (fileUploadControl.files.length > 0) {
//                            console.log("inside if condition");
//                            var file = fileUploadControl.files[0];
//                            var name = "photo.jpg";
//
//                            var parseFile = new Parse.File(name, file);
//
//                            profileObj.picture = parseFile;
//                        }
//                    }
//                    catch (exp) {
//                        console.log("exception here");
//                        console.log(exp.message);
//                    }
                    });
        }
    }


    $(function () {

        $('#myModal').on('hidden.bs.modal', function () {
            console.log("event called");
            // do something…
            if (doweUpdateAnything) {
                doweUpdateAnything = false;
                if (selectedProfile.get("name") != undefined && selectedProfile.get("name") != null && selectedProfile.get("name") != "") {
                    console.log("we are in");
                    Parse.Cloud.run("ProfilePhotoSave", {"profile": selectedProfile.id}, {
                        success: function (result) {
                            console.log("finally done");

                        },
                        error: function (err) {
                            console.log("still there");
                        }
                    });
                }
            }
        })


        $("#bp").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getCities", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name") + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("birth place field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var bpId = JSON.parse(ui.item.jsonS);
                document.getElementById("bpobj").value = bpId["objectId"];
                return ui.item.label;
            }
        });


        $("#cl").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getCities", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name") + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("current location field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var clId = JSON.parse(ui.item.jsonS);
                document.getElementById("clobj").value = clId["objectId"];
                return ui.item.label;
            }
        });

        //    Religion auto-complete
        $("#rel").autocomplete({

            source: function (request, response) {
                Parse.Cloud.run("getReligion", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Religion field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var relId = JSON.parse(ui.item.jsonS);
                document.getElementById("relobj").value = relId["objectId"];
                return ui.item.label;
            }
        });
        $("#caste").autocomplete({

            source: function (request, response) {
                var religionId = document.getElementById("relobj").value;
                console.log(religionId);
                Parse.Cloud.run("getCaste", {"searchThis": request.term, religion: religionId}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Caste field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var casteId = JSON.parse(ui.item.jsonS);
                document.getElementById("casteobj").value = casteId["objectId"];
                return ui.item.label;
            }
        });

        $("#work").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getIndustry", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Industry field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var indusId = JSON.parse(ui.item.jsonS);
                document.getElementById("indusobj").value = indusId["objectId"];
                return ui.item.label;
            }
        });

        $("#edu").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getEducation", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Education field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var eduId = JSON.parse(ui.item.jsonS);
                document.getElementById("eduobj").value = eduId["objectId"];
                return ui.item.label;
            }
        });

        $("#spe").autocomplete({

            source: function (request, response) {
                var eduId = document.getElementById("eduobj").value;
                console.log(eduId);
                Parse.Cloud.run("getSpecial", {"searchThis": request.term, education: eduId}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Caste field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var special = JSON.parse(ui.item.jsonS);
                document.getElementById("speobj").value = special["objectId"];
                return ui.item.label;
            }
        });
        $("#username").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getUserName", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("username");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("username"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("user field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
//                var indusId = JSON.parse(ui.item.jsonS);
//                document.getElementById("indusobj").value = indusId["objectId"];
                return ui.item.label;
            }
        });

    });


    function addAnUser() {
        var name = document.getElementById("name").value;
        var mob = document.getElementById("mob").value;
        var gender = document.getElementById("sex").value;

        var birthDay = document.getElementById("bday").value;
        var birthTime = document.getElementById("btime").value;

        var birthPlace = document.getElementById("bplace").value;
        var currentLocation = document.getElementById("location").value;

        var weigth = document.getElementById("weight").value;
        var height = document.getElementById("height").value;

        var religion = document.getElementById("religion").value;
        var caste = document.getElementById("caste").value;
        var manglikStatus = document.getElementById("manglik").value;

        var work = document.getElementById("working").value;
        var designation = document.getElementById("designation").value;

        var company = document.getElementById("company").value;
        var ctc = document.getElementById("ctc").value;

        var edu1 = document.getElementById("edu1").value;
        var edu2 = document.getElementById("edu2").value;

        var edu3 = document.getElementById("edu3").value;
        var wam = document.getElementById("wam").value;
        Parse.Cloud.run('addUsers', {
            username: name,
            number: mob,
            gender: gender,
            dob: birthDay,
            tob: birthTime,
            bplace: birthPlace,
            currloc: currentLocation,
            weight: weigth,
            height: height,
            religion: religion,
            caste: caste,
            manglik: manglikStatus,
            working: work,
            desig: designation,
            comp: company,
            income: ctc,
            edu1: edu1,
            edu2: edu2,
            edu3: edu3,
            wam: wam,
            adminId: '2BohswJjfi',
            relation: 'Admin'
        }, {
            success: function (result) {
                alert("Aded");
            },
            error: function (error) {
                alert("Not added.");
            }
        });
    }
    function doWait() {
        window.location.href = "http://mandaptakdev.parseapp.com/#";
    }
    function show(message) {
        $('#pleaseWaitDialog').modal();
        document.getElementById("textToShow").innerHTML = message;
        setTimeout(5000);
    }

    function close() {
        $('#pleaseWaitDialog').modal('hide');
    }

</script>
</html>

