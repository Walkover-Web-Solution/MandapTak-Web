<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'/>
    <title>Cloud Code Demo - 3 - Parse.Cloud.httpRequest</title>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->
    <!--<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />-->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>-->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>-->
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.min.js"></script>
    <script>
        function jsfunction(operation) {
            var val = document.getElementById("pageno").value;
            if (operation == 1) {
                document.getElementById("pageno").value = ++val;

            }
            else if (operation == 0 && val != 1) {
                document.getElementById("pageno").value = --val;
            }
            getAllProfiles(val);
        }

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#blah')
                            .attr('src', e.target.result)
                            .width(150)
                            .height(200);
                };

                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</head>
<body>
<div class="container">
    <h2>Bordered Table</h2>

    <p>The .table-bordered class adds borders to a table:</p>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Mobile number</th>
            <th>Name</th>
            <th>isComplete</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="profileTable">

        </tbody>
    </table>
    <ul class="pager">
        <li><a onclick="jsfunction(0)" href="#">Previous</a></li>
        <li><input type="text" disabled id="pageno" value="1"></li>
        <li><a onclick="jsfunction(1)" href="#">Next</a></li>
    </ul>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="Login" aria-hidden="true">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body" style="float:none">
                <form id="profileForm" class="form-horizontal center-block">
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" class="form-control" id="name" placeholder="Enter name">
                    </div>
                    <div class="form-group">
                        <label>Gender:</label>
                        <select id="genderSelect" class="selectpicker" class="form-control"
                                onchange="showOptionsAge(this)">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date Of Birth:</label>
                        <input type="date" class="form-control" id="dob" placeholder="Enter Date of Birth">
                    </div>
                    <div class="form-group">
                        <label>Time Of Birth:</label>
                        <input type="time" class="form-control" id="tob" placeholder="Enter Time of Birth">
                    </div>
                    <div class="form-group ui-widget">
                        <label>Birth Place:</label>
                        <input type="text" class="form-control" id="bp" placeholder="Enter Birth Place">
                    </div>
                    <div class="form-group ui-widget">
                        <label>Current Location:</label>
                        <input type="text" class="form-control" id="cl" placeholder="Enter Current Location">
                    </div>

                    <div class="form-group">
                        <label>Weight:</label>
                        <input type="number" class="form-control" id="weight" placeholder="Enter Weight">
                    </div>
                    <div class="form-group">
                        <label>Height:</label>
                        <input type="number" class="form-control" id="height" placeholder="Enter Height">
                    </div>
                    <div class="form-group ui-widget">
                        <label>Religion:</label>
                        <input type="text" class="form-control" id="rel" placeholder="Enter Religion">
                    </div>
                    <div class="form-group">
                        <label>Caste:</label>
                        <input type="text" class="form-control" id="caste" placeholder="Enter Caste">
                    </div>

                    <div class="form-group">
                        <label>Manglik Status:</label>
                        <select id="manglikSelect" class="selectpicker" class="form-control"
                                onchange="showOptionsManglik(this)">
                            <option value="0">Don't Know</option>
                            <option value="1">Yes</option>
                            <option value="2">No</option>
                        </select>
                    </div>
                    <div class="form-group ui-widget">
                        <label>Industry:</label>
                        <input type="text" class="form-control" id="work" placeholder="Enter Work">
                    </div>
                    <div class="form-group">
                        <label>Designation:</label>
                        <input type="text" class="form-control" id="desig" placeholder="Enter Designation">
                    </div>
                    <div class="form-group">
                        <label>Company:</label>
                        <input type="text" class="form-control" id="comp" placeholder="Enter Company">
                    </div>
                    <div class="form-group">
                        <label>Current Income(per annum):</label>
                        <input type="number" class="form-control" id="income" placeholder="Enter Current Income">
                    </div>
                    <div class="form-group ui-widget">
                        <label>Education:</label>
                        <input type="text" class="form-control" id="edu" placeholder="Enter Education">
                        <input type="text" class="form-control" id="spe" placeholder="Enter Specialization">
                    </div>
                    <!--
                     Hidden fields
                    -->
                    <div class="form-group">
                        <label></label>
                        <input type="hidden" class="form-control" id="bpobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="clobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="relobj">
                    </div>

                    <div class="form-group">
                        <input type="hidden" class="form-control" id="casteobj">
                    </div>

                    <div class="form-group">
                        <input type="hidden" class="form-control" id="eduobj">
                        <input type="hidden" class="form-control" id="speobj">
                    </div>
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="indusobj">
                    </div>
                    <!-- Hidden Fields-->

                    <div class="form-group">
                        <label>Want To Work After Marriage:</label>
                        <select id="workSelect" class="selectpicker" class="form-control">
                            <option value="0">May be</option>
                            <option value="1">Yes</option>
                            <option value="2">No</option>
                        </select>
                    </div>
                    <!--<div class="form-group">-->
                        <!--<label>Browse Image:</label>-->
                        <!--<input type="file" id="profilePhotoFileUpload">-->
                        <!--&lt;!&ndash;<img id="blah" src="#" alt="your image" />&ndash;&gt;-->
                    <!--</div>-->

                    <input type="button" value="SaveProfile" onclick="saveProfile()"/>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="saveProfile()">Close</button>
            </div>
        </div>

    </div>
</div>

</div>
</div>

<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal"
        onclick="getAllProfiles(1)">
    Launch demo modal
</button>


</body>


<script src='https://www.parsecdn.com/js/parse-1.2.18.min.js'></script>
<script>

    var selectedProfile;
    var picFile;
    function showOptionsAge(s) {
        //console.log(s[s.selectedIndex].value); // get value
        // console.log(s[s.selectedIndex].id); // get id
        gender = s[s.selectedIndex].value;

    }
    function showOptionsManglik(s) {
        //console.log(s[s.selectedIndex].value); // get value
        // console.log(s[s.selectedIndex].id); // get id
        manglikStatus = s[s.selectedIndex].value;

    }
    function showOptionsMarriage(s) {
        //console.log(s[s.selectedIndex].value); // get value
        // console.log(s[s.selectedIndex].id); // get id
        workAfterMarriage = s[s.selectedIndex].value;

    }
    Parse.initialize("Uj7WryNjRHDQ0O3j8HiyoFfriHV8blt2iUrJkCN0", "owBEWHkWBEEmmaukvUiKSOJhuSaQcOrKqhzqGNyi");
    function login() {
        Parse.Cloud.run('authenticate', {username: '0000000007', password: '12345678'}, {
            success: function (result) {
                window.alert(result.get("username"));
                document.getElementById("result").innerHTML = result.get("username");
            },
            error: function (error) {

            }
        });
    }

    function getAllProfiles(pageNo) {
        Parse.Cloud.run('getAllProfiles', {pageno: pageNo}, {
            success: function (result) {
                var html = "";
                for (var i = 0; i < result.length; i++) {
                    html += "<tr><td>" + result[i].get("userId").get("username") + "</td><td>" + result[i].get("name") +
                            "</td><td>" + result[i].get("isComplete") + "</td><td><button class='btn btn-primary' data-toggle='modal' data-target='#myModal' onclick='editProfile(" + JSON.stringify(result[i]) + ")'>EDIT</button></td></tr>";
                }
                document.getElementById("profileTable").innerHTML = html;
            },
            error: function (error) {

            }
        });
    }

    function editProfile(profile) {
        console.log(profile.objectId);
        var objectId = profile.objectId;
        Parse.Cloud.run("getProfile", {profileId: objectId}, {
                    success: function (result) {
                        console.log(result.get("userId").get("username"));
                        selectedProfile = result;
                        document.getElementById("name").value = selectedProfile.get("name");
                        document.getElementById("weight").value = selectedProfile.get("weight");
                        document.getElementById("height").value = selectedProfile.get("height");
//                        document.getElementById("dob").value = (selectedProfile.get("dob")).getDate();
//                        document.getElementById("tob").value = selectedProfile.get("tob");
                        document.getElementById("desig").value = selectedProfile.get("designation");
                        document.getElementById("income").value = selectedProfile.get("package");
                        document.getElementById("comp").value = selectedProfile.get("placeOfWork");
                    }
                }
        );
    }

    function saveProfile() {
       // var parseFile = new Parse.File(picFile.name, picFile);
        var profileObj = {};
        profileObj.id = selectedProfile.id;
        profileObj.name = document.getElementById("name").value;
        profileObj.gender = document.getElementById("genderSelect").value;
        profileObj.dob = document.getElementById("dob").value;
        profileObj.tob = document.getElementById("tob").value;
        profileObj.birthPlace = document.getElementById("bpobj").value;
        profileObj.currentLocation = document.getElementById("clobj").value;
        profileObj.weight = document.getElementById("weight").value;
        profileObj.height = document.getElementById("height").value;
        profileObj.religion = document.getElementById("relobj").value;
        profileObj.caste = document.getElementById("casteobj").value;
        profileObj.manglik = document.getElementById("manglikSelect").value;
        profileObj.industry = document.getElementById("indusobj").value;
        profileObj.designation = document.getElementById("desig").value;
        profileObj.company = document.getElementById("comp").value;
        profileObj.package = document.getElementById("income").value;
        profileObj.education = document.getElementById("speobj").value;
        profileObj.wantToWork = document.getElementById("workSelect").value;
        //profileObj.picture = picFile;
        console.log(profileObj.gender);
        Parse.Cloud.run("saveProfile", {profiletosave: profileObj}, {
                    success: function (result) {
                        console.log(result);
                    },
                    error:function(error){
                        console.log(error);
                    }
                }
        );
    }


    $(function () {

//        $('#profilePhotoFileUpload').bind("change", function(e) {
//
//            var fileUploadControl = $("#profilePhotoFileUpload")[0];
//            picFile = fileUploadControl.files[0];
//        });

        $("#bp").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getCities", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name") + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("birth place field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var bpId = JSON.parse(ui.item.jsonS);
                document.getElementById("bpobj").value = bpId["objectId"];
                return ui.item.label;
            }
        });


        $("#cl").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getCities", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name") + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("current location field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var clId = JSON.parse(ui.item.jsonS);
                document.getElementById("clobj").value = clId["objectId"];
                return ui.item.label;
            }
        });

        //    Religion auto-complete
        $("#rel").autocomplete({

            source: function (request, response) {
                Parse.Cloud.run("getReligion", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Religion field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var relId = JSON.parse(ui.item.jsonS);
                document.getElementById("relobj").value = relId["objectId"];
                return ui.item.label;
            }
        });
        $("#caste").autocomplete({

            source: function (request, response) {
                var religionId = document.getElementById("relobj").value;
                console.log(religionId);
                Parse.Cloud.run("getCaste", {"searchThis": request.term, religion: religionId}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Caste field not working");
                    }
                })
            },
            minLength: 2,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var casteId = JSON.parse(ui.item.jsonS);
                document.getElementById("casteobj").value = casteId["objectId"];
                return ui.item.label;
            }
        });

        $("#work").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getIndustry", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Industry field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var indusId = JSON.parse(ui.item.jsonS);
                document.getElementById("indusobj").value = indusId["objectId"];
                return ui.item.label;
            }
        });

        $("#edu").autocomplete({
            source: function (request, response) {
                Parse.Cloud.run("getEducation", {"searchThis": request.term}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Education field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var eduId = JSON.parse(ui.item.jsonS);
                document.getElementById("eduobj").value = eduId["objectId"];
                return ui.item.label;
            }
        });

        $("#spe").autocomplete({

            source: function (request, response) {
                var eduId = document.getElementById("eduobj").value;
                console.log(eduId);
                Parse.Cloud.run("getSpecial", {"searchThis": request.term, education: eduId}, {
                    success: function (result) {
                        showThisResult = [];
                        for (var i = 0; i < result.length; i++) {
                            var obj = {};
                            obj.label = result[i].get("name");// + "," + result[i].get("Parent").get("name") + "," + result[i].get("Parent").get("Parent").get("name");
                            obj.value = obj.label;
                            obj.jsonS = JSON.stringify(result[i]);
                            showThisResult.push(obj);
                            console.log(result[i].get("name"));
                        }
                        response(showThisResult);
                    },
                    error: function (error) {
                        alert("Caste field not working");
                    }
                })
            },
            minLength: 1,
            select: function (event, ui) {

                console.log(ui ?
                "Selected: " + ui.item.value :
                "Nothing selected, input was " + this.value);
                //this.value = ui.item.value.get("name") + "," + ui.item.value.get("Parent").get("name") + "," + ui.item.value.get("Parent").get("Parent").get("name");
                var special = JSON.parse(ui.item.jsonS);
                document.getElementById("speobj").value = special["objectId"];
                return ui.item.label;
            }
        });

    });


    function addAnUser() {
        var name = document.getElementById("name").value;
        var mob = document.getElementById("mob").value;
        var gender = document.getElementById("sex").value;

        var birthDay = document.getElementById("bday").value;
        var birthTime = document.getElementById("btime").value;

        var birthPlace = document.getElementById("bplace").value;
        var currentLocation = document.getElementById("location").value;

        var weigth = document.getElementById("weight").value;
        var height = document.getElementById("height").value;

        var religion = document.getElementById("religion").value;
        var caste = document.getElementById("caste").value;
        var manglikStatus = document.getElementById("manglik").value;

        var work = document.getElementById("working").value;
        var designation = document.getElementById("designation").value;

        var company = document.getElementById("company").value;
        var ctc = document.getElementById("ctc").value;

        var edu1 = document.getElementById("edu1").value;
        var edu2 = document.getElementById("edu2").value;

        var edu3 = document.getElementById("edu3").value;
        var wam = document.getElementById("wam").value;
        Parse.Cloud.run('addUsers', {
            username: name,
            number: mob,
            gender: gender,
            dob: birthDay,
            tob: birthTime,
            bplace: birthPlace,
            currloc: currentLocation,
            weight: weigth,
            height: height,
            religion: religion,
            caste: caste,
            manglik: manglikStatus,
            working: work,
            desig: designation,
            comp: company,
            income: ctc,
            edu1: edu1,
            edu2: edu2,
            edu3: edu3,
            wam: wam,
            adminId: '2BohswJjfi',
            relation: 'Admin'
        }, {
            success: function (result) {
                alert("Aded");
            },
            error: function (error) {
                alert("Not added.");
            }
        });
    }

</script>
</html>

